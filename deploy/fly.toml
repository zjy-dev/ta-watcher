# Fly.io configuration
# https://fly.io/

# App name (will be auto-generated or set during deployment)
app = "ta-watcher"

# Kill signal
kill_signal = "SIGINT"
kill_timeout = 5

[build]
# Use cloud-optimized Dockerfile
dockerfile = "Dockerfile.cloud"

# Machine configuration
[machine]
# Use cron machine type for scheduled jobs
# This is more cost-effective than running continuously
machine_type = "cron"

# Resource limits
cpu_kind = "shared"
cpus = 1
memory = "512mb"

# Cron job configuration
[cron]
# Run twice daily: 6AM and 6PM Beijing Time (22:00 and 10:00 UTC)
schedule = "0 10,22 * * *"

# Command to run
cmd = ["/ta-watcher", "--single-run", "--config", "/config.yaml"]

# Environment variables
[env]
TZ = "UTC"
LOG_LEVEL = "info"

# Health check configuration
[http_service]
internal_port = 8080
force_https = true
auto_stop_machines = true
auto_start_machines = true

[http_service.checks]
# Health check endpoint
[http_service.checks.health]
grace_period = "5s"
interval = "30s"
method = "GET"
path = "/health"
timeout = "10s"

# Secrets (set via `flyctl secrets set`)
# flyctl secrets set SMTP_HOST=smtp.gmail.com
# flyctl secrets set SMTP_USERNAME=your-email@gmail.com
# flyctl secrets set SMTP_PASSWORD=your-app-password
# flyctl secrets set FROM_EMAIL=your-email@gmail.com
# flyctl secrets set TO_EMAIL=recipient@example.com

# Optional webhook secrets:
# flyctl secrets set FEISHU_WEBHOOK_URL=https://open.feishu.cn/...
# flyctl secrets set WECHAT_WEBHOOK_URL=https://qyapi.weixin.qq.com/...
